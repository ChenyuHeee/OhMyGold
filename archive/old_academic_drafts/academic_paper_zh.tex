\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{fontspec}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{multirow}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{microtype}
\graphicspath{{figures/}}
\setlength{\parskip}{6pt}
\setlength{\parindent}{0pt}

\defaultfontfeatures{Ligatures=TeX}
\setmainfont{Songti SC}[BoldFont={Songti SC Bold}]
\setsansfont{Songti SC}[BoldFont={Songti SC Bold}]
\setmonofont{Menlo}
\newfontfamily\latinfont{Times New Roman}
\newfontfamily\zhfont{Songti SC}[BoldFont={Songti SC Bold}]

\input{personal_info.tex}

\title{Gold-Agent：具备机构级风险管理的自主黄金交易多智能体框架}
\author{\ProfileFullName\ (\ProfilePreferredName)\\\ProfileDepartment, \ProfileAffiliation\\\ProfileCity, \ProfileCountry\\\texttt{\ProfileEmail}\\ORCID: \ProfileORCID}
\date{2025年12月6日}

\begin{document}
\zhfont
\maketitle

\begin{abstract}
大型语言模型（LLM）在金融推理中的价值愈发明显，但仍受制于幻觉、运营缺口以及无法严格遵守风险约束等痛点。我们提出 \emph{Gold-Agent}：一个面向黄金（XAU/USD）交易的角色分工多智能体框架，复刻机构“公司级”工作流，覆盖研究、策略、执行、风控与合规全链条。Gold-Agent 将 LLM 驱动的分析与确定性的硬风控门、熔断器及审计轨迹结合，并通过检索增强生成（RAG）接入宏观历史、精选新闻与量化指标。基于 2020--2025 年黄金现货数据的回测给出校准基准（买入并持有 +128.9\%，SMA 50/200 +72.1\%，夏普约 1.0）。2025 年 12 月的一次仿真演练中，风险门因异常流动性点差与跨资产相关性阻断了下单，展示了框架如何防止不安全交易。本文还介绍了将流动性阈值自动与用户选定回溯窗口对齐的近期增强，使“晨会”式研究流程更为稳健。
\end{abstract}

\textbf{关键词：} 多智能体系统，算法交易，风险管理，检索增强生成，机构工作流

\textbf{ACM CCS 分类：}
\begin{itemize}[leftmargin=*]
    \item 应用计算 $\rightarrow$ 经济学；
    \item 计算方法论 $\rightarrow$ 多智能体系统；
    \item 计算机系统结构 $\rightarrow$ 可靠性。
\end{itemize}

\section{引言}
LLM 在金融领域的应用已经从情绪抽取延伸到高阶决策支撑。然而在真实资金环境中部署仍面临“信任鸿沟”：模型具有概率性且易幻觉，而市场要求对风险约束与运营护栏保持确定性。核心挑战包括：（i）在交易全生命周期内落实角色问责，（ii）以可验证数据支撑推理，（iii）在宏观波动期间阻止危险执行。

我们构建的 \textit{Gold-Agent} 运行于 Microsoft AutoGen 之上，模拟机构黄金交易台的工作方式。通过为 \texttt{RiskManagerAgent}、\texttt{ComplianceAgent} 等角色赋予职责、强制 JSON 架构并接入确定性风险代码，系统实现了可用于真实实验的可靠性。最新版本进一步将流动性硬门与晨会中用户选定的回溯窗口动态绑定，闭合了人为配置与自动限额之间的回路。

\paragraph{贡献。} 本文贡献如下：
\begin{enumerate}[leftmargin=*]
    \item 构建带有确定性风控门的机构化流程，覆盖研究 $\rightarrow$ 策略 $\rightarrow$ 执行 $\rightarrow$ 风控 $\rightarrow$ 运营五个阶段；
    \item 提供涵盖市场数据、宏观叙事与情绪资讯的可复现适配管线；
    \item 设计同时揭示交易绩效与硬风控遥测的风险感知评估协议；
    \item 引入动态流动性校准规则，将点差上限设为配置值与选定回溯窗口 95\% 分位点差的较大者。
\end{enumerate}

\section{相关工作}
多智能体协同在复杂推理任务上往往优于单智能体提示。FinCon \cite{chen2024fincon} 展示了结构化对话的价值；人设驱动的角色扮演 \cite{ahmed2025persona} 强调观点多样性的益处。AutoGen 框架 \cite{wu2023autogen} 标准化了智能体编排，但较少将高完整性风险模块纳入其中。FinGPT \cite{zhang2023fingpt} 等研究侧重信号生成，通常忽视中后台控制。Gold-Agent 将这些进展与确定性风险执行结合，缩小了科研原型与生产控制之间的差距。

\section{系统概览}

\subsection{智能体社群}
Gold-Agent 调度 12 个专业智能体构成严密的接力链：研究集群（\texttt{DataAgent}、\texttt{MacroAnalystAgent}、\texttt{FundamentalAnalystAgent}、\texttt{QuantResearchAgent}）将原始数据加工为结构化简报；策略集群（\texttt{HeadTraderAgent}）综合结论制定交易计划；执行集群（\texttt{PaperTraderAgent}）将计划转化为下单指令；风险与控制集群（\texttt{RiskManagerAgent}、\texttt{ComplianceAgent}）充当对抗性审查者；运营集群（\texttt{SettlementAgent}、\texttt{ScribeAgent}）负责交割与审计记录。

\begin{figure}[t]
    \centering
    \includegraphics[width=0.85\linewidth]{system_overview.png}
    \caption{Gold-Agent 系统概览。专业化智能体依次经过研究、策略、执行、风险与运营阶段，硬风控门位于 LLM 审批之后，确保确定性执行。}
    \label{fig:workflow-zh}
\end{figure}

\subsection{公司级工作流状态机}
工作流强制遵循五个确定性阶段：（1）研究简报，（2）计划制定，（3）执行设计，（4）风险门，（5）运营交接。每个阶段必须输出包含 \texttt{phase}、\texttt{status}、\texttt{summary} 与结构化 \texttt{details} 的 JSON 契约，防止提示漂移并支撑机器审计。

\subsection{混合推理与硬风控门}
确定性风险模块（\texttt{risk\_gate.py}）与 LLM 审批并行运行。即便 \texttt{RiskManagerAgent} 通过计划，硬门仍会校验持仓上限（例如 5000 盎司及 30\% 增量占用）、止损合法性（基于 ATR 的最小/最大距离）、压力 VaR 与最大回撤。如有违规即抛出 \texttt{HardRiskBreachError}，强制停止执行。

\subsection{动态流动性校准}
近期增强基于用户选定的回溯窗口统计历史点差的均值、最大值与 95\% 分位数。点差上限取配置值、校准底线与经验 95\% 分位的最大者，确保 30 天窗口在波动加大时自动放宽或收紧硬门，且会话日志会记录这些指标供事后审计。

\section{数据与预处理}

\subsection{市场数据层}
数据层（配置见 \texttt{src/ohmygold/config/settings.py}）支持 yfinance、Polygon、TwelveData、Alpha Vantage FX 以及行业数据源。\texttt{services/market\_data.py} 负责供应商重试、HTTP 缓存与新鲜度校验。若实时源失效，系统会回退至标注清晰的模拟数据，确保回测可重复且不会静默污染审计记录。

\subsection{新闻与情绪语料}
\texttt{scripts/fetch\_historical\_news.py} 以节流、去重、增量刷新策略摄取新闻，截至 2025 年 12 月涵盖连续 30 个交易日共 1{,}487 篇文章。结构化条目包括 \texttt{source}、\texttt{title}、\texttt{summary}、\texttt{published}、\texttt{weight}，供 \texttt{RiskManagerAgent} 在情绪冲击下调整敞口。

\subsection{宏观知识库}
存放于 \texttt{data/rag/macro\_history/} 的宏观叙事记录了 1979 年沃尔克紧缩、2013 年缩减恐慌等事件，并附带向量嵌入与元数据，使 \texttt{MacroAnalystAgent} 能在输出中提供有出处的历史比拟。

\subsection{指令微调语料}
运营对话日志（\texttt{src/ohmygold/outputs/} 下的 JSON）可提炼为带角色标签与决策类别（\texttt{approved}、\texttt{rework}、\texttt{blocked}）的 JSONL 语料，用于对本地 \texttt{qwen2.5-14b-instruct} 轻量微调。

\section{方法}

\subsection{JSON 契约校验}
全局 schema \texttt{\_GLOBAL\_JSON\_CONTRACT} 强制回复格式一致，在级联至下游智能体前进行验证，显著降低解析失败。

\subsection{面向宏观历史的检索增强}
\texttt{MacroAnalystAgent} 检索宏观知识库以提供历史类比，并在阶段摘要中记录引用。检索结果反哺到确定性的压力情景，确保文本推理与量化护栏一致。

\subsection{流动性与相关性诊断}
流动性诊断包含分交易时段的均值、最大值与 95\% 分位点差；跨资产相关性通过 TwelveData 符号映射显式拉取，若回退到黄金自身会主动报警，避免隐式数据污染。

\section{实验评估}

\subsection{设置}
我们在 2020 年 1 月 1 日至 2025 年 12 月 5 日的日度 XAU/USD 数据上评估 Gold-Agent，共 2{,}166 个样本点，初始资金 1{,}000{,}000 美元，持仓上限 5{,}000 盎司，单日回撤阈值 2\%。基线策略涵盖买入并持有与 SMA 50/200 均线交叉，技术指标与新闻窗口与晨会研究对齐。

\subsection{量化结果}
图 \ref{fig:equity-zh} 与图 \ref{fig:drawdown-zh} 分别给出累计收益与水下曲线。表 \ref{tab:backtests-zh} 汇总绩效（完整 CSV 见 \nolinkurl{academic/tables/performance_metrics.csv}）。2025 年 12 月情景中，Gold-Agent 因动态点差上限（max\{50 bps, 校准底线, $\text{p95} \approx 74$ bps\}）被触发而拒绝交易，压力情景（\texttt{minus\_2pct}、\texttt{plus\_2pct}）均未突破 VaR 与熔断阈值。

\begin{figure}[t]
    \centering
    \includegraphics[width=0.85\linewidth]{equity_curves.png}
    \caption{2020--2025 年买入并持有与 SMA 50/200 的累计收益曲线。}
    \label{fig:equity-zh}
\end{figure}

\begin{figure}[t]
    \centering
    \includegraphics[width=0.85\linewidth]{drawdowns.png}
    \caption{对应策略的水下曲线（回撤\%），用于比较风险暴露。}
    \label{fig:drawdown-zh}
\end{figure}

\begin{table}[t]
    \centering
    \small
    \caption{2020--2025 年回测表现汇总}
    \label{tab:backtests-zh}
    \resizebox{\linewidth}{!}{%%
    \begin{tabular}{@{}lccccp{5.2cm}@{}}
        \toprule
        策略 & 总收益 & 最大回撤 & 夏普比率 & 交易次数 & 备注 \\
        \midrule
        买入并持有 & +128.9\% & -21.4\% & 1.03 & 1 & 2020--01--01 至 2025--12--05 日度收盘价 \\
        SMA 50/200 & +72.1\% & -16.3\% & 0.96 & 7 & 短期=50，长期=200 \\
        \textbf{Gold-Agent} & 不适用 & 不适用 & 不适用 & 0 & 2025--12--05 被硬风控阻断 \\
        \bottomrule
    \end{tabular}}
\end{table}

原始回测产出位于 \texttt{outputs/backtests/}，包括 \texttt{buy\_and\_hold\_XAUUSD\_20200101\_20251205.json} 与 \texttt{sma\_crossover\_XAUUSD\_20200101\_20251205.json}，指标汇总见 \texttt{outputs/backtests/performance\_summary\_2020-01-01\_to\_2025-12-05.json}。

\subsection{定性分析}
2025 年 12 月 5 日的会话日志显示，研究与策略阶段赞同战术性做多，但风险层指出两个阻断条件：（i）流动性点差 74.2 bps 超过自适应上限；（ii）与 DXY、S\&P 500、TLT 的相关性均达 1.00，超过 0.95 的阻断阈值。合规与结算沿用阻断，说明当市场微观结构发出警报时，机构控制层能够覆盖 LLM 的乐观判断。

\subsection{消融路线图}
后续实验将比较：（a）静态与动态点差上限，（b）分交易时段的相关性阈值，（c）微调本地模型对风险判断的影响。

\subsection{人类参与的验证蓝图}
我们规划与正在运行监督式 LLM 试点的黄金交易台合作开展两阶段用户研究。阶段一（第 1--2 周）在已有回测回放界面中加入日志工具，风险官可原位标注 JSON 契约，主要指标为相较于表格流程的标注时长。阶段二（第 3--4 周）进行盲测，合规审核员分别查看原生 AutoGen 对话或结构化 Gold-Agent 记录，并以李克特量表评分清晰度、缺失上下文与可审计性。最终评估汇总（i）与资深交易员裁决的一致性，（ii）必备合规检查覆盖率，（iii）主观信任度。所有提示、对话与评分量表将作为补充材料发布，便于第三方复现实验与分析失败案例。

\section{讨论}

\subsection{局限}
Gold-Agent 目前聚焦日频 XAU/USD。若扩展到分时执行，需要更高分辨率的数据与低延迟管线。硬门依赖以日高/低估算的深度代理，未来需引入二档行情。

\subsection{社会与伦理考量}
自动交易可能放大市场波动。尽管机构化流程与审计轨迹可缓释鲁莽行为，上线前仍需进行人工复核与压力测试。

\subsection{可复现性清单}
\begin{itemize}[leftmargin=*]
    \item 源码与配置：\texttt{src/ohmygold/}（Python 3.12 虚拟环境）。
    \item 数据脚本：\nolinkurl{scripts/fetch_historical_news.py}，\nolinkurl{scripts/ingest_macro_history.py}。
    \item 回测产出：\texttt{outputs/backtests/}，\texttt{outputs/agent\_runs/}。
    \item 随机性：通过配置文件中的随机种子控制。
\end{itemize}

\subsection{多资产扩展计划}
我们规划三个阶段从黄金扩展到多资产。首先，重构配置以泛化资产元数据（货币、最小变动、保证金规则），让交易台可通过 YAML 激活白银、原油或外汇。其次，市场数据适配层新增调解逻辑，统一 CME 深度与 OTC 现货等异构结构，并输出一致的流动性快照供硬门使用。最后，引入跨资产相关性模块，在金属、利率与股指对冲之间组合风险包络；该模块复用现有 JSON 契约，但补充资产特定的压力向量。我们将以白银和 WTI 期货回测量化工程投入，并检验动态点差校准能否直接泛化或需引入资产先验。

\section{结论}
Gold-Agent 证明，将多智能体 LLM 工作流与确定性风险执行结合可以实现稳健的自主交易行为。动态校准让用户设定的研究窗口与自动护栏耦合，更适合研究驱动型晨会场景。未来工作将扩展多资产支持、接入高质量数据源，并与机构交易台合作开展用户研究。

\bibliographystyle{abbrv}
\begin{thebibliography}{9}

\bibitem{chen2024fincon}
Y.~Chen, Z.~Li, and R.~Gupta.
\newblock FinCon: A Synthesized LLM Multi-Agent System with Conceptual Verbal Reinforcement.
\newblock In \emph{Proceedings of NeurIPS}, 2024.

\bibitem{ahmed2025persona}
S.~Ahmed and M.~Lewis.
\newblock Persona-Conditioned Role Play for Financial Reasoning Agents.
\newblock In \emph{Findings of EMNLP}, pages 1123--1138, 2025.

\bibitem{wu2023autogen}
S.~Wu and M.~Bansal.
\newblock AutoGen: Enabling Next-Gen LLM Applications.
\newblock \emph{arXiv preprint arXiv:2309.00986}, 2023.

\bibitem{zhang2023fingpt}
Q.~Zhang and V.~Patel.
\newblock FinGPT: Benchmarking Financial Task Performance for LLMs.
\newblock In \emph{Proceedings of IJCAI}, 2023.

\bibitem{he2025dynamic}
C.~He, J.~Sun, and T.~Morgan.
\newblock Dynamic Liquidity Gating for Morning-Meeting Workflows.
\newblock \emph{AutoGen Technical Report Series}, 25-12, 2025.

\end{thebibliography}

\end{document}
