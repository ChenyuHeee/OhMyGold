# Release Notes – 2025-12-04 (v0.2.0)

## 概览
- **数据统一**：工具层全面改用 `services.market_data.fetch_price_history`，并在 Settings 中预置 TwelveData / Polygon symbol map，消除对 `yfinance` 的直接依赖。
- **风控升级**：`services.risk_gate.evaluate_plan` 实现硬闸门拦截，CLI 捕获 `HardRiskBreachError` 并生成结构化报告；配套 `docs/workflows/risk_gate_flow.md` 与风险/合规模型提示词更新。
- **RAG 能力**：`scripts/ingest_macro_history.py` 新增命名空间、标签、日志写盘，`rag_tools` 支持默认语料回退，`HashingEmbeddingFunction` 适配新版 Chroma 接口。
- **文档与工具**：整理行情供应商接入 (`docs/requirements/market_data_subscription_plan.md`)、ArbitrageAgent 规划、RAG 素材 backlog，并在 README 中汇总入口。

## 必要动作
1. **API 申请**：
   - IBKR：申请 Market Data 订阅（Metals bundle）及 API 凭证（Client Portal → API）。
   - Polygon.io：升级至含 `Currencies`/`Indices`/`Commodities` 数据权限的计划；生成并填写 `POLYGON_API_KEY`。
   - FRED：注册并获取免费 `FRED_API_KEY`。
   - TradingEconomics：确认配额计划，申请 `Client Key/Secret` 并配置。
2. **配置更新**：
   - `.env` 中补充上述 API Key 及订阅状态，按需覆写 `twelve_data_symbol_map` / `polygon_symbol_map`。
   - 如果启用本地模型或套利角色，预先设定 `LOCAL_MODEL_*`、`arbitrage_enabled`（准备后续版本）。
3. **向量库**：
   - 运行 `python scripts/ingest_macro_history.py --log-dir outputs/ingest_logs` 完成语料 ingest，并留存日志。

## 兼容性说明
- 需要 Python 3.10 及以上。
- `chromadb>=0.5`（建议 0.5.x 最新版），因嵌入接口已适配新签名。
- 运行 `pip install .` 将自动安装所需依赖。

## 测试
- `pytest`（全部 42 项通过，耗时约 120s）。

## 未完项（Follow-up）
- ArbitrageAgent 尚在规划阶段；相关提示词与工具已备好，待实现 Agent 工厂与工作流接入。
- RAG ingest 计划扩展标签筛选测试与 CI 自动化。
- 供应商订阅审批（IBKR/TradingEconomics）与财务确认仍在进行中。
